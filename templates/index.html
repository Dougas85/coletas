<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8">
    <title>Coletas - Cruzamento</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  </head>
  <body class="bg-light">
    <div class="container py-4">
      <h3>Coletas - Cruzamento Histórico x Arquivo do Dia</h3>

      <div class="mb-3">
        <div class="alert alert-info">
          Base histórica carregada: <strong>{{ base_count }}</strong> linhas.
        </div>
      </div>

      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          {% for cat, msg in messages %}
            <div class="alert alert-{{ 'success' if cat=='success' else ('warning' if cat=='warning' else 'danger') }} alert-sm">
              {{ msg }}
            </div>
          {% endfor %}
        {% endif %}
      {% endwith %}

      <div class="card mb-3">
        <div class="card-body">
          <h5>Enviar arquivo do dia</h5>
          <p>Formato esperado: arquivo exportado do sistema com colunas incluindo <strong>Remetente</strong>, <strong>Endereço Origem</strong> e <strong>CEP Origem</strong>. Aceita .txt e .csv.</p>
          <form method="post" action="{{ url_for('upload_dia') }}" enctype="multipart/form-data">
            <div class="mb-2">
              <input type="file" name="file" accept=".txt,.csv" class="form-control" required>
            </div>
            <button class="btn btn-primary btn-sm" type="submit">Processar arquivo do dia</button>
          </form>
        </div>
      </div>

      <div>
        <small class="text-muted">Após processamento você verá os endereços repetidos e poderá baixar o PDF.</small>
      </div>
    </div>
  </body>
</html>
